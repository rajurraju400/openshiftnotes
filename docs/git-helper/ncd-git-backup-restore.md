# Backing up Nokia Git Server
> this procedure, works for NCD 24.9 mp1 pp2. 


## Instructions on backing up Nokia Git Server


#### backup utility will generate the following outputs

* database.sql file containing the PostgreSQL database content
* Git repository data
* Kubernetes secrets required for the upgrade
* backup_information.yml generated by the backup tool

1. Example of backup_information.yml

```
:db_version: 20240508085441
:backup_created_at: 2024-06-13 13:57:08 +0000
:gitlab_version: 17.0.1
:tar_version: tar (GNU tar) 1.34
:installation_type: gitlab-helm-chart
:skipped: builds,pages,registry,uploads,artifacts,lfs,packages,
external_diffs,terraform_state,pages,ci_secure_files
:repositories_server_side: false
```



#### Prerequisites

* To back up Nokia Git Server and the necessary Helm plugins for Backup and Recovery (CBUR), CBUR must be installed on your cluster.
* CBUR must be enabled in the Nokia Git Server installation.

##### Install plugins for helm (backup and restore)

1.  Download the backup and restore plugin via following git link. 

* [Open helm backup link](https://github.com/maorfr/helm-backup)

```
[root@ncputility ~ panhub_rc]$ file helm-backup-master.zip
helm-backup-master.zip: Zip archive data, at least v1.0 to extract
[root@ncputility ~ panhub_rc]$
```

2. extract the downloaded package. 

```
[root@ncputility ~ panhub_rc]$ unzip helm-backup-master.zip
Archive:  helm-backup-master.zip
3cdde8b6d0d3c28368b66426e4f2933d700c93a2
   creating: helm-backup-master/
  inflating: helm-backup-master/.gitignore
  inflating: helm-backup-master/Gopkg.lock
  inflating: helm-backup-master/Gopkg.toml
  inflating: helm-backup-master/LICENSE.txt
  inflating: helm-backup-master/Makefile
  inflating: helm-backup-master/README.md
  inflating: helm-backup-master/install-binary.sh
  inflating: helm-backup-master/main.go
  inflating: helm-backup-master/plugin.yaml
[root@ncputility ~ panhub_rc]$

```
3. install the backup login now 

```
[root@ncputility ~ panhub_rc]$ helm plugin install ./helm-backup-master/
Downloading and installing helm-backup 0.1.3 ...
https://github.com/maorfr/helm-backup/releases/download/0.1.3/helm-backup-linux-0.1.3.tgz
Installed plugin: backup
[root@ncputility ~ panhub_rc]$

```

4. Validate the install the helm backup

```
[root@ncputility ~ panhub_rc]$ helm plugin list
NAME    VERSION DESCRIPTION
backup  0.1.2   backup/restore releases in a namespace to/from a file
[root@ncputility ~ panhub_rc]$

```

#### Back up Nokia Git Server

```
The CBUR master service (CBUR_MASTER_SERVICE) must be specified in either of the following formats:
http(s)://dns_name:port
http(s)://ipv4:port
http(s)://[ipv6]:port
http(s)://dns_name
http(s)://ingress/ingresspath
```

helm backup -t ncd-git -a none -n paclypancdgit01 -x http://172.20.8.113:80

helm backup -n paclypancdgit01 -t ncd-git -a none -x http://172.20.8.113:80




#### Reference 

1.  NCDFM tickets
* https://jiradc2.ext.net.nokia.com/browse/NCDFM-3023