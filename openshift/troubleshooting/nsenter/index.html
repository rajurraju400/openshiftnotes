<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Nsenter Usage - OpenShift Notes</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">OpenShift Notes</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Git Helper</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../git-helper/ncd-git-backup/" class="dropdown-item">Git Backup</a>
</li>
                                    
<li>
    <a href="../../../git-helper/ncd-git-restore/" class="dropdown-item">Git Restore</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Deployment Scripts</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../git-helper/Deployment/backupconfig.sh" class="dropdown-item">Backup Config</a>
</li>
            
<li>
    <a href="../../../git-helper/Deployment/newgitserver.sh" class="dropdown-item">New Git Server</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">OpenShift</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Backup & Restore</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../backup-restore/ACM-GEO-RED/" class="dropdown-item">ACM GEO Red</a>
</li>
            
<li>
    <a href="../../backup-restore/ACM-localbackup/" class="dropdown-item">ACM Local Backup</a>
</li>
            
<li>
    <a href="../../backup-restore/AWS-S3/" class="dropdown-item">AWS S3 Backup</a>
</li>
            
<li>
    <a href="../../backup-restore/etcd-backup/" class="dropdown-item">ETCD Backup</a>
</li>
            
<li>
    <a href="../../backup-restore/etcd-restore/" class="dropdown-item">ETCD Restore</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">CNF Onboarding Support</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../CNF-onboarding-support/image-tls-issue/" class="dropdown-item">Image TLS Issue</a>
</li>
            
<li>
    <a href="../../CNF-onboarding-support/oclogin-tls-issue/" class="dropdown-item">OCLogin TLS Issue</a>
</li>
            
<li>
    <a href="../../CNF-onboarding-support/proxy-cache-pod/" class="dropdown-item">Proxy Cache Pod</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../../deployment/readme/" class="dropdown-item">Deployment</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Maintenance</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../maintenace/cluster-stop-start/" class="dropdown-item">Cluster Stop/Start</a>
</li>
            
<li>
    <a href="../../maintenace/reboot-nodes/" class="dropdown-item">Reboot Nodes</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Networking</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../networking/metalb-troubleshooting/" class="dropdown-item">MetalLB Troubleshooting</a>
</li>
            
<li>
    <a href="../../networking/metallb-configuration/" class="dropdown-item">MetalLB Configuration</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Storage Management</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../storagemanagement/ceph-rebalanceissue/" class="dropdown-item">Ceph Rebalance Issue</a>
</li>
            
<li>
    <a href="../../storagemanagement/storage-node-replacement/" class="dropdown-item">Storage Node Replacement</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../../tools-management-ts/ts-tools/" class="dropdown-item">Tools Management TS</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Troubleshooting</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Nsenter Usage</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">User Management</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../usermanagement/remove-kubeadmin/" class="dropdown-item">Remove Kubeadmin</a>
</li>
            
<li>
    <a href="../../usermanagement/user-management/" class="dropdown-item">User Management</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../tools-management-ts/ts-tools/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../usermanagement/remove-kubeadmin/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#method-to-use-nsenter-on-the-ocp" class="nav-link">Method to use nsenter on the OCP</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="method-to-use-nsenter-on-the-ocp">Method to use nsenter on the OCP</h1>
<blockquote>
<p>Please find the method to use nsenter, so that you will not struggle during your deployment. </p>
</blockquote>
<ol>
<li>Login to the ocp cluster with cluster admin role and find the pod name which you want to login inside the container using nsenter. <code>ncom01pan-caas-plugin-9bd7755bb-bb5fs</code> is selected.</li>
</ol>
<pre><code>[root@ncputility ~ pancwl_rc]$ source /root/pancwlrc
WARNING: Using insecure TLS client config. Setting this option is not supported!

Login successful.

You have access to 119 projects, the list has been suppressed. You can list all projects with 'oc projects'

Using project &quot;ncom01pan&quot;.
[root@ncputility ~ pancwl_rc]$ oc get pods -A -o wide |grep -i ^C
[root@ncputility ~ pancwl_rc]$ oc get pods -n ncom01pan -o wide |grep -i caas
ncom01pan-caas-plugin-9bd7755bb-bb5fs                       1/1     Running             0          3h15m   172.17.18.34    appworker23.panclypcwl01.mnc020.mcc714   &lt;none&gt;           &lt;none&gt;
ncom01pan-caas-plugin-9bd7755bb-cwzmm                       1/1     Running             0          3h15m   172.18.8.78     appworker16.panclypcwl01.mnc020.mcc714   &lt;none&gt;           &lt;none&gt;
[root@ncputility ~ pancwl_rc]$
</code></pre>
<ol>
<li>execute to that node where your pod hosted, and this will be indentified from the previous command. </li>
</ol>
<pre><code>[root@ncputility ~ pancwl_rc]$ oc debug -t node/appworker0.panclypcwl01.mnc020.mcc714
Temporary namespace openshift-debug-vz9qc is created for debugging node...
Starting pod/appworker0panclypcwl01mnc020mcc714-debug-87f7l ...
To use host binaries, run `chroot /host`
Pod IP: 10.89.96.26
If you don't see a command prompt, try pressing enter.
sh-5.1# chroot /host
sh-5.1#
</code></pre>
<ol>
<li>now find out the container id using crictl command here </li>
</ol>
<pre><code>sh-5.1# crictl ps |grep -i ncom01pan-caas-plugin-7654b86fdb-mz5r7
2b61910d5eb23       quay-registry.apps.panclyphub01.mnc020.mcc714/ncom01pan/ncom/caas-plugin@sha256:d6d9506d14d756ecafe7d93debcb9eeb498cc805506fb1480002713d17ce64d6   19 minutes ago      Running             cjee-wildfly                         0                   8ca17869e45fa       ncom01pan-caas-plugin-7654b86fdb-mz5r7

</code></pre>
<ol>
<li>find out the pid of the container using inspect command. </li>
</ol>
<pre><code>sh-5.1# crictl inpsect 2b61910d5eb23 |grep -i pid
No help topic for 'inpsect'
sh-5.1# crictl inspect 2b61910d5eb23 |grep -i pid
    &quot;pid&quot;: 60545,
          &quot;pids&quot;: {
            &quot;type&quot;: &quot;pid&quot;
                &quot;getpid&quot;,
                &quot;getppid&quot;,
                &quot;pidfd_getfd&quot;,
                &quot;pidfd_open&quot;,
                &quot;pidfd_send_signal&quot;,
                &quot;waitpid&quot;,
</code></pre>
<ol>
<li>now use the toolbox command, since tcpdump is not configured on the host os level. </li>
</ol>
<pre><code>sh-5.1# toolbox
.toolboxrc file detected, overriding defaults...
Checking if there is a newer version of quay-registry.apps.panclyphub01.mnc020.mcc714/ocmirror/rhel9/support-tools:latest available...
Container 'toolbox-root' already exists. Trying to start...
(To remove the container and start with a fresh toolbox, run: sudo podman rm 'toolbox-root')
toolbox-root
Container started successfully. To exit, type 'exit'.
[root@appworker0 /]# nsenter -t 60545 -n ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: gre0@NONE: &lt;NOARP&gt; mtu 1476 qdisc noop state DOWN group default qlen 1000
    link/gre 0.0.0.0 brd 0.0.0.0
3: gretap0@NONE: &lt;BROADCAST,MULTICAST&gt; mtu 1462 qdisc noop state DOWN group default qlen 1000
    link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff
4: erspan0@NONE: &lt;BROADCAST,MULTICAST&gt; mtu 1450 qdisc noop state DOWN group default qlen 1000
    link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff
5: ip6tnl0@NONE: &lt;NOARP&gt; mtu 1452 qdisc noop state DOWN group default qlen 1000
    link/tunnel6 :: brd :: permaddr 3eac:e266:df07::
6: ip6gre0@NONE: &lt;NOARP&gt; mtu 1448 qdisc noop state DOWN group default qlen 1000
    link/gre6 :: brd :: permaddr 6679:afbc:3648::
7: eth0@if609: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 8900 qdisc noqueue state UP group default
    link/ether 0a:58:ac:10:04:0f brd ff:ff:ff:ff:ff:ff link-netns d00bdece-6c79-4840-87d1-10d3103ecdd7
    inet 172.16.4.15/23 brd 172.16.5.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::858:acff:fe10:40f/64 scope link
       valid_lft forever preferred_lft forever
[root@appworker0 /]# nsenter -t 60545 -n ping  quay-registry.apps.panclyphub01.mnc020.mcc714
PING quay-registry.apps.panclyphub01.mnc020.mcc714 (10.89.97.143) 56(84) bytes of data.
From 10.89.97.168 (10.89.97.168) icmp_seq=1 Destination Host Unreachable
From 10.89.97.168 (10.89.97.168) icmp_seq=2 Destination Host Unreachable
From 10.89.97.168 (10.89.97.168) icmp_seq=3 Destination Host Unreachable
From 10.89.97.168 (10.89.97.168) icmp_seq=4 Destination Host Unreachable

^C
--- quay-registry.apps.panclyphub01.mnc020.mcc714 ping statistics ---
5 packets transmitted, 0 received, +4 errors, 100% packet loss, time 4089ms
pipe 4
[root@appworker0 /]# nsenter -t 60545 -n ping  10.89.97.143
PING 10.89.97.143 (10.89.97.143) 56(84) bytes of data.
From 10.89.97.168 icmp_seq=1 Destination Host Unreachable
From 10.89.97.168 icmp_seq=2 Destination Host Unreachable
From 10.89.97.168 icmp_seq=3 Destination Host Unreachable
From 10.89.97.168 icmp_seq=4 Destination Host Unreachable

^C
--- 10.89.97.143 ping statistics ---
4 packets transmitted, 0 received, +4 errors, 100% packet loss, time 3088ms
pipe 4
[root@appworker0 /]# nsenter -t 60545 -n tracepath 10.89.97.143
 1?: [LOCALHOST]                      pmtu 8900
 1:  *.apps.panclyphub01.mnc020.mcc714                     1.683ms asymm  2
 1:  *.apps.panclyphub01.mnc020.mcc714                     0.878ms asymm  2
 2:  100.88.0.7                                            1.903ms asymm  3
 3:  172.17.2.2                                            2.086ms
 4:  no reply
 4:  10.89.97.168                                        3087.371ms !H
     Resume: pmtu 8900
[root@appworker0 /]#
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
